
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pandas &#8212; test book</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data visualization using Python" href="03_python_vis.html" />
    <link rel="prev" title="Python tools for data science" href="01_python_tools_ds.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      <h1 class="site-logo" id="site-title">test book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   An Introduction to Data Science using Python
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00_python_primer.html">
   A Python Primer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_python_tools_ds.html">
   Python tools for data science
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_python_vis.html">
   Data visualization using Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_python_stat.html">
   Statistical analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_python_learning.html">
   Machine Learning using Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_python_appl.html">
   String manipulation
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/02_python_pandas.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/02_python_pandas.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#starting-pandas">
   Starting pandas
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import-and-export">
   Data import and export
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-a-data-set">
   Exploring a data set
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-structures-and-types">
   Data structures and types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pandas-series">
     pandas.Series
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pandas-dataframe">
     pandas.DataFrame
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creating-a-dataframe">
       Creating a DataFrame
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#working-with-a-dataframe">
       Working with a DataFrame
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#extracting-rows-and-columns">
       Extracting rows and columns
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#boolean-selection">
       Boolean selection
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#query">
       <code class="docutils literal notranslate">
        <span class="pre">
         query
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replacing-values-in-a-dataframe">
       Replacing values in a DataFrame
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-data">
     Categorical data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#re-organizing-categories">
       Re-organizing categories
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#missing-data">
     Missing data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-transformation">
   Data transformation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arithmetic-operations">
     Arithmetic operations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#concatenation-of-data-sets">
     Concatenation of data sets
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adding-columns">
       Adding columns
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merging-data-sets">
     Merging data sets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tidy-data-principles-and-reshaping-datasets">
     Tidy data principles and reshaping datasets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#melting-unpivoting-data">
     Melting (unpivoting) data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#separating-columns-containing-multiple-variables">
     Separating columns containing multiple variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pivot-spread-datasets">
     Pivot/spread datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-aggregation-and-split-apply-combine">
   Data aggregation and split-apply-combine
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformation">
     Transformation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter">
     Filter
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Introduction" data-toc-modified-id="Introduction-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Introduction</a></span></li><li><span><a href="#Starting-pandas" data-toc-modified-id="Starting-pandas-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Starting pandas</a></span></li><li><span><a href="#Data-import-and-export" data-toc-modified-id="Data-import-and-export-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Data import and export</a></span></li><li><span><a href="#Exploring-a-data-set" data-toc-modified-id="Exploring-a-data-set-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Exploring a data set</a></span></li><li><span><a href="#Data-structures-and-types" data-toc-modified-id="Data-structures-and-types-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Data structures and types</a></span><ul class="toc-item"><li><span><a href="#pandas.Series" data-toc-modified-id="pandas.Series-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>pandas.Series</a></span></li><li><span><a href="#pandas.DataFrame" data-toc-modified-id="pandas.DataFrame-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>pandas.DataFrame</a></span><ul class="toc-item"><li><span><a href="#Creating-a-DataFrame" data-toc-modified-id="Creating-a-DataFrame-5.2.1"><span class="toc-item-num">5.2.1&nbsp;&nbsp;</span>Creating a DataFrame</a></span></li><li><span><a href="#Working-with-a-DataFrame" data-toc-modified-id="Working-with-a-DataFrame-5.2.2"><span class="toc-item-num">5.2.2&nbsp;&nbsp;</span>Working with a DataFrame</a></span></li><li><span><a href="#Extracting-rows-and-columns" data-toc-modified-id="Extracting-rows-and-columns-5.2.3"><span class="toc-item-num">5.2.3&nbsp;&nbsp;</span>Extracting rows and columns</a></span></li><li><span><a href="#Boolean-selection" data-toc-modified-id="Boolean-selection-5.2.4"><span class="toc-item-num">5.2.4&nbsp;&nbsp;</span>Boolean selection</a></span></li><li><span><a href="#query" data-toc-modified-id="query-5.2.5"><span class="toc-item-num">5.2.5&nbsp;&nbsp;</span><code>query</code></a></span></li><li><span><a href="#Replacing-values-in-a-DataFrame" data-toc-modified-id="Replacing-values-in-a-DataFrame-5.2.6"><span class="toc-item-num">5.2.6&nbsp;&nbsp;</span>Replacing values in a DataFrame</a></span></li></ul></li><li><span><a href="#Categorical-data" data-toc-modified-id="Categorical-data-5.3"><span class="toc-item-num">5.3&nbsp;&nbsp;</span>Categorical data</a></span><ul class="toc-item"><li><span><a href="#Re-organizing-categories" data-toc-modified-id="Re-organizing-categories-5.3.1"><span class="toc-item-num">5.3.1&nbsp;&nbsp;</span>Re-organizing categories</a></span></li></ul></li><li><span><a href="#Missing-data" data-toc-modified-id="Missing-data-5.4"><span class="toc-item-num">5.4&nbsp;&nbsp;</span>Missing data</a></span></li></ul></li><li><span><a href="#Data-transformation" data-toc-modified-id="Data-transformation-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Data transformation</a></span><ul class="toc-item"><li><span><a href="#Arithmetic-operations" data-toc-modified-id="Arithmetic-operations-6.1"><span class="toc-item-num">6.1&nbsp;&nbsp;</span>Arithmetic operations</a></span></li><li><span><a href="#Concatenation-of-data-sets" data-toc-modified-id="Concatenation-of-data-sets-6.2"><span class="toc-item-num">6.2&nbsp;&nbsp;</span>Concatenation of data sets</a></span><ul class="toc-item"><li><span><a href="#Adding-columns" data-toc-modified-id="Adding-columns-6.2.1"><span class="toc-item-num">6.2.1&nbsp;&nbsp;</span>Adding columns</a></span></li></ul></li><li><span><a href="#Merging-data-sets" data-toc-modified-id="Merging-data-sets-6.3"><span class="toc-item-num">6.3&nbsp;&nbsp;</span>Merging data sets</a></span></li><li><span><a href="#Tidy-data-principles-and-reshaping-datasets" data-toc-modified-id="Tidy-data-principles-and-reshaping-datasets-6.4"><span class="toc-item-num">6.4&nbsp;&nbsp;</span>Tidy data principles and reshaping datasets</a></span></li><li><span><a href="#Melting-(unpivoting)-data" data-toc-modified-id="Melting-(unpivoting)-data-6.5"><span class="toc-item-num">6.5&nbsp;&nbsp;</span>Melting (unpivoting) data</a></span></li><li><span><a href="#Separating-columns-containing-multiple-variables" data-toc-modified-id="Separating-columns-containing-multiple-variables-6.6"><span class="toc-item-num">6.6&nbsp;&nbsp;</span>Separating columns containing multiple variables</a></span></li><li><span><a href="#Pivot/spread-datasets" data-toc-modified-id="Pivot/spread-datasets-6.7"><span class="toc-item-num">6.7&nbsp;&nbsp;</span>Pivot/spread datasets</a></span></li></ul></li><li><span><a href="#Data-aggregation-and-split-apply-combine" data-toc-modified-id="Data-aggregation-and-split-apply-combine-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Data aggregation and split-apply-combine</a></span><ul class="toc-item"><li><ul class="toc-item"><li><span><a href="#Transformation" data-toc-modified-id="Transformation-7.0.1"><span class="toc-item-num">7.0.1&nbsp;&nbsp;</span>Transformation</a></span></li><li><span><a href="#Filter" data-toc-modified-id="Filter-7.0.2"><span class="toc-item-num">7.0.2&nbsp;&nbsp;</span>Filter</a></span></li></ul></li></ul></li></ul></div><div class="section" id="pandas">
<h1>Pandas<a class="headerlink" href="#pandas" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> is the Python Data Analysis package. It allows for data ingestion, transformation and cleaning, and creates objects that can then be passed on to analytic packages like <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> and <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> for modeling and packages like <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>, and <code class="docutils literal notranslate"><span class="pre">plotly</span></code> for visualization.</p>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> is built on top of numpy, so many numpy functions are commonly used in manipulating <code class="docutils literal notranslate"><span class="pre">pandas</span></code> objects.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> is a pretty extensive package, and we’ll only be able to cover some of its features. For more details, there is free online documentation at <a class="reference external" href="https://pandas.pydata.org">pandas.pydata.org</a>. You can also look at the book <a class="reference external" href="https://www.amazon.com/Python-Data-Analysis-Wrangling-IPython-dp-1491957662/dp/1491957662/">“Python for Data Analysis (2nd edition)”</a> by Wes McKinney, the original developer of the pandas package, for more details.</p>
</div></blockquote>
</div>
<div class="section" id="starting-pandas">
<h2>Starting pandas<a class="headerlink" href="#starting-pandas" title="Permalink to this headline">¶</a></h2>
<p>As with any Python module, you have to “activate” <code class="docutils literal notranslate"><span class="pre">pandas</span></code> by using <code class="docutils literal notranslate"><span class="pre">import</span></code>. The “standard” alias for <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is <code class="docutils literal notranslate"><span class="pre">pd</span></code>. We will also import <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, since <code class="docutils literal notranslate"><span class="pre">pandas</span></code> uses some <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functions in the workflows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-import-and-export">
<h2>Data import and export<a class="headerlink" href="#data-import-and-export" title="Permalink to this headline">¶</a></h2>
<p>Most data sets you will work with are set up in tables, so are rectangular in shape. Think Excel spreadsheets. In <code class="docutils literal notranslate"><span class="pre">pandas</span></code> the structure that will hold this kind of data is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.  We can read external data into a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> using one of many <code class="docutils literal notranslate"><span class="pre">read_*</span></code> functions. We can also write from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to a variety of formats using <code class="docutils literal notranslate"><span class="pre">to_*</span></code> functions. The most common of these are listed below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Format type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>reader</p></th>
<th class="head"><p>writer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>text</p></td>
<td><p>CSV</p></td>
<td><p>read_csv</p></td>
<td><p>to_csv</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Excel</p></td>
<td><p>read_excel</p></td>
<td><p>to_excel</p></td>
</tr>
<tr class="row-even"><td><p>text</p></td>
<td><p>JSON</p></td>
<td><p>read_json</p></td>
<td><p>to_json</p></td>
</tr>
<tr class="row-odd"><td><p>binary</p></td>
<td><p>Feather</p></td>
<td><p>read_feather</p></td>
<td><p>to_feather</p></td>
</tr>
<tr class="row-even"><td><p>binary</p></td>
<td><p>SAS</p></td>
<td><p>read_sas</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>SQL</p></td>
<td><p>SQL</p></td>
<td><p>read_sql</p></td>
<td><p>to_sql</p></td>
</tr>
</tbody>
</table>
<p>We’ll start by reading in the <code class="docutils literal notranslate"><span class="pre">mtcars</span></code> dataset stored as a CSV file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/mtcars.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">177290536.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/mtcars.csv&#39;</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">706</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/mtcars.csv&#39;
</pre></div>
</div>
</div>
</div>
<p>This just prints out the data, but then it’s lost. To use this data, we have to give it a name, so it’s stored in Python’s memory</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/mtcars.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">156186092.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/mtcars.csv&#39;</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">706</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/mtcars.csv&#39;
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>One of the big differences between a spreadsheet program and a programming language from the data science perspective is that you have to load data into the programming language. It’s not “just there” like Excel. This is a good thing, since it allows the common functionality of the programming language to work across multiple data sets, and also keeps the original data set pristine. Excel users can run into problems and <a class="reference external" href="https://nature.berkeley.edu/garbelottoat/?p=1488">corrupt their data</a> if they are not careful.</p>
</div></blockquote>
<p>If we wanted to write this data set back out into an Excel file, say, we could do</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;data/mtcars.xlsx&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">619313533.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;data/mtcars.xlsx&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;mtcars&#39; is not defined
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>You may get an error if you don’t have the <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code> package installed. You can easily install it from the Anaconda prompt using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">openpyxl</span></code> and following the prompts.</p>
</div></blockquote>
</div>
<div class="section" id="exploring-a-data-set">
<h2>Exploring a data set<a class="headerlink" href="#exploring-a-data-set" title="Permalink to this headline">¶</a></h2>
<p>We would like to get some idea about this data set. There are a bunch of functions linked to the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object that help us in this. First we will use <code class="docutils literal notranslate"><span class="pre">head</span></code> to see the first 8 rows of this data set</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">934582116.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;mtcars&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>This is our first look into this data. We notice a few things. Each column has a name, and each row has an <em>index</em>, starting at 0.</p>
<blockquote>
<div><p>If you’re interested in the last N rows, there is a corresponding <code class="docutils literal notranslate"><span class="pre">tail</span></code> function</p>
</div></blockquote>
<p>Let’s look at the data types of each of the columns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2146946782.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span><span class="o">.</span><span class="n">dtypes</span>

<span class="ne">NameError</span>: name &#39;mtcars&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>This tells us that some of the variables, like <code class="docutils literal notranslate"><span class="pre">mpg</span></code> and <code class="docutils literal notranslate"><span class="pre">disp</span></code>, are floating point (decimal) numbers, several are integers, and <code class="docutils literal notranslate"><span class="pre">make</span></code> is an “object”. The <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> function borrows from <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, where there isn’t really a type for character or categorical variables. So most often, when you see “object” in the output of <code class="docutils literal notranslate"><span class="pre">dtypes</span></code>, you think it’s a character or categorical variable.</p>
<p>We can also look at the data structure in a bit more detail.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1363358996.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;mtcars&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>This tells us that this is indeed a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, wth 12 columns, each with 32 valid observations. Each row has an index value ranging from 0 to 11. We also get the approximate size of this object in memory.</p>
<p>You can also quickly find the number of rows and columns of a data set by using <code class="docutils literal notranslate"><span class="pre">shape</span></code>, which is borrowed from numpy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3305424329.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span><span class="o">.</span><span class="n">shape</span>

<span class="ne">NameError</span>: name &#39;mtcars&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>More generally, we can get a summary of each variable using the <code class="docutils literal notranslate"><span class="pre">describe</span></code> function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">725493899.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mtcars</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;mtcars&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>These are usually the first steps in exploring the data.</p>
</div>
<div class="section" id="data-structures-and-types">
<h2>Data structures and types<a class="headerlink" href="#data-structures-and-types" title="Permalink to this headline">¶</a></h2>
<p>pandas has two main data types: <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. These are analogous to vectors and matrices, in that a <code class="docutils literal notranslate"><span class="pre">Series</span></code> is 1-dimensional while a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is 2-dimensional.</p>
<div class="section" id="pandas-series">
<h3>pandas.Series<a class="headerlink" href="#pandas-series" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Series</span></code> object holds data from a single input variable, and is required, much like numpy arrays, to be homogeneous in type. You can create <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects from lists or numpy arrays quite easily</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span>
<span class="n">s</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     1.0
1     3.0
2     5.0
3     NaN
4     9.0
5    13.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">s2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      1
1      2
2      3
3      4
4      5
5      6
6      7
7      8
8      9
9     10
10    11
11    12
12    13
13    14
14    15
15    16
16    17
17    18
18    19
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>You can access elements of a <code class="docutils literal notranslate"><span class="pre">Series</span></code> much like a <code class="docutils literal notranslate"><span class="pre">dict</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<p>There is no requirement that the index of a <code class="docutils literal notranslate"><span class="pre">Series</span></code> has to be numeric. It can be any kind of scalar object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,)),</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="n">s3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    0.330965
b    0.399645
c   -0.377409
d   -1.344155
e   -0.525576
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-1.3441554682740278
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    0.330965
b    0.399645
c   -0.377409
d   -1.344155
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Well, slicing worked, but it gave us something different than expected. It gave us both the start <strong>and</strong> end of the slice, which is unlike what we’ve encountered so far!!</p>
<p>It turns out that in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, slicing by index actually does this. It is a discrepancy from <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and Python in general that we have to be careful about.</p>
<p>You can extract the actual values into a numpy array</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.33096497,  0.39964536, -0.37740946, -1.34415547, -0.52557625])
</pre></div>
</div>
</div>
</div>
<p>In fact, you’ll see that much of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>’ structures are build on top of <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays. This is a good thing, since you can take advantage of the powerful numpy functions that are built for fast, efficient scientific computing.</p>
<p>Making the point about slicing again,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.33096497,  0.39964536, -0.37740946])
</pre></div>
</div>
</div>
</div>
<p>This is different from index-based slicing done earlier.</p>
</div>
<div class="section" id="pandas-dataframe">
<h3>pandas.DataFrame<a class="headerlink" href="#pandas-dataframe" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object holds a rectangular data set. Each column of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object. This means that each column of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> must be comprised of data of the same type, but different columns can hold data of different types. This structure is extremely useful in practical data science. The invention of this structure was, in my opinion, transformative in making Python an effective data science tool.</p>
<div class="section" id="creating-a-dataframe">
<h4>Creating a DataFrame<a class="headerlink" href="#creating-a-dataframe" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> can be created by importing data, as we saw in the previous section. It can also be created by a few methods within Python.</p>
<p>First, it can be created from a 2-dimensional <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">d1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.228273</td>
      <td>1.026890</td>
      <td>-0.839585</td>
      <td>-0.591182</td>
      <td>-0.956888</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.222326</td>
      <td>-0.619915</td>
      <td>1.837905</td>
      <td>-2.053231</td>
      <td>0.868583</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.920734</td>
      <td>-0.232312</td>
      <td>2.152957</td>
      <td>-1.334661</td>
      <td>0.076380</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.246089</td>
      <td>1.202272</td>
      <td>-1.049942</td>
      <td>1.056610</td>
      <td>-0.419678</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You will notice that it creates default column names, that are merely the column number, starting from 0. We can also create the column names and row index (similar to the <code class="docutils literal notranslate"><span class="pre">Series</span></code> index we saw earlier) directly during creation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> 
                  <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">],</span> 
                  <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
<span class="n">d2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2.294842</td>
      <td>-2.594487</td>
      <td>2.822756</td>
      <td>0.680889</td>
      <td>-1.577693</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-1.976254</td>
      <td>0.533340</td>
      <td>-0.290870</td>
      <td>-0.513520</td>
      <td>1.982626</td>
    </tr>
    <tr>
      <th>c</th>
      <td>0.226001</td>
      <td>-1.839905</td>
      <td>1.607671</td>
      <td>0.388292</td>
      <td>0.399732</td>
    </tr>
    <tr>
      <th>d</th>
      <td>0.405477</td>
      <td>0.217002</td>
      <td>-0.633439</td>
      <td>0.246622</td>
      <td>-1.939546</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<blockquote>
<div><p>We could also create a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> from a list of lists, as long as things line up, just as we showed for <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays. However, to me, other ways, including the <code class="docutils literal notranslate"><span class="pre">dict</span></code> method below, make more sense.</p>
</div></blockquote>
<p>We can change the column names (which can be extracted and replaced with the <code class="docutils literal notranslate"><span class="pre">columns</span></code> attribute) and the index values (using the <code class="docutils literal notranslate"><span class="pre">index</span></code> attribute).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;V&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)])</span> <span class="c1"># Index creates the right objects for both column names and row names, which can be extracted and changed with the `index` attribute</span>
<span class="n">d2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>V1</th>
      <th>V2</th>
      <th>V3</th>
      <th>V4</th>
      <th>V5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2.294842</td>
      <td>-2.594487</td>
      <td>2.822756</td>
      <td>0.680889</td>
      <td>-1.577693</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-1.976254</td>
      <td>0.533340</td>
      <td>-0.290870</td>
      <td>-0.513520</td>
      <td>1.982626</td>
    </tr>
    <tr>
      <th>c</th>
      <td>0.226001</td>
      <td>-1.839905</td>
      <td>1.607671</td>
      <td>0.388292</td>
      <td>0.399732</td>
    </tr>
    <tr>
      <th>d</th>
      <td>0.405477</td>
      <td>0.217002</td>
      <td>-0.633439</td>
      <td>0.246622</td>
      <td>-1.939546</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Exercise:</strong> Can you explain what I did in the list comprehension above? The key points are understanding <code class="docutils literal notranslate"><span class="pre">str</span></code> and how I constructed the <code class="docutils literal notranslate"><span class="pre">range</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o1&#39;</span><span class="p">,</span><span class="s1">&#39;o2&#39;</span><span class="p">,</span><span class="s1">&#39;o3&#39;</span><span class="p">,</span><span class="s1">&#39;o4&#39;</span><span class="p">]</span>
<span class="n">d2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>V1</th>
      <th>V2</th>
      <th>V3</th>
      <th>V4</th>
      <th>V5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>o1</th>
      <td>2.294842</td>
      <td>-2.594487</td>
      <td>2.822756</td>
      <td>0.680889</td>
      <td>-1.577693</td>
    </tr>
    <tr>
      <th>o2</th>
      <td>-1.976254</td>
      <td>0.533340</td>
      <td>-0.290870</td>
      <td>-0.513520</td>
      <td>1.982626</td>
    </tr>
    <tr>
      <th>o3</th>
      <td>0.226001</td>
      <td>-1.839905</td>
      <td>1.607671</td>
      <td>0.388292</td>
      <td>0.399732</td>
    </tr>
    <tr>
      <th>o4</th>
      <td>0.405477</td>
      <td>0.217002</td>
      <td>-0.633439</td>
      <td>0.246622</td>
      <td>-1.939546</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can also extract data from a homogeneous <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.22827309,  1.0268903 , -0.83958485, -0.59118152, -0.9568883 ],
       [-0.22232569, -0.61991511,  1.83790458, -2.05323076,  0.86858305],
       [-0.92073444, -0.23231186,  2.1529569 , -1.33466147,  0.07637965],
       [-1.24608928,  1.20227231, -1.04994158,  1.05661011, -0.41967767]])
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>It turns out that you can use <code class="docutils literal notranslate"><span class="pre">to_numpy</span></code> for a non-homogeneous <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> as well. <code class="docutils literal notranslate"><span class="pre">numpy</span></code> just makes it homogeneous by assigning each column the data type <code class="docutils literal notranslate"><span class="pre">object</span></code>. This also limits what you can do in <code class="docutils literal notranslate"><span class="pre">numpy</span></code> with the array and may require changing data types using the <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.astype.html"><code class="docutils literal notranslate"><span class="pre">astype</span></code> function</a>. There is some more detail about the <code class="docutils literal notranslate"><span class="pre">object</span></code> data type in the Python Tools for Data Science (<a class="reference external" href="01_python_tools_ds.ipynb#object">notebook</a>, <span class="xref myst">PDF</span>) document.</p>
</div></blockquote>
<p>The other easy way to create a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is from a <code class="docutils literal notranslate"><span class="pre">dict</span></code> object, where each component object is either a list or a numpy array, and is homogeneous in type. One exception is if a component is of size 1; then it is repeated to meet the needs of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>’s dimensions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="mf">3.</span><span class="p">,</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20200512&#39;</span><span class="p">),</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="s1">&#39;NIH&#39;</span><span class="p">})</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.0</td>
      <td>0.958092</td>
      <td>2020-05-12</td>
      <td>6</td>
      <td>yes</td>
      <td>NIH</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.0</td>
      <td>0.883201</td>
      <td>2020-05-12</td>
      <td>6</td>
      <td>no</td>
      <td>NIH</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.295432</td>
      <td>2020-05-12</td>
      <td>6</td>
      <td>no</td>
      <td>NIH</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>0.512376</td>
      <td>2020-05-12</td>
      <td>6</td>
      <td>yes</td>
      <td>NIH</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.0</td>
      <td>0.088702</td>
      <td>2020-05-12</td>
      <td>6</td>
      <td>no</td>
      <td>NIH</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 5 entries, 0 to 4
Data columns (total 6 columns):
 #   Column  Non-Null Count  Dtype         
---  ------  --------------  -----         
 0   A       5 non-null      float64       
 1   B       5 non-null      float64       
 2   C       5 non-null      datetime64[ns]
 3   D       5 non-null      int64         
 4   E       5 non-null      category      
 5   F       5 non-null      object        
dtypes: category(1), datetime64[ns](1), float64(2), int64(1), object(1)
memory usage: 457.0+ bytes
</pre></div>
</div>
</div>
</div>
<p>We note that C is a date object, E is a category object, and F is a text/string object. pandas has excellent time series capabilities (having origins in FinTech), and the <code class="docutils literal notranslate"><span class="pre">TimeStamp</span></code> function creates datetime objects which can be queried and manipulated in Python. We’ll describe category data in the next section.</p>
<p>You can also create a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> where each column is composed of composite objects, like lists and dicts, as well. This might have limited value in some settings, but may be useful in others. In particular, this allows capabilities like the <a class="reference external" href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html"><em>list-column</em> construct in R tibbles</a>. For example,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;list&#39;</span> <span class="p">:[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span>
             <span class="s1">&#39;tuple&#39;</span> <span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)],</span>
              <span class="s1">&#39;set&#39;</span> <span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;F&#39;</span><span class="p">}],</span> 
            <span class="s1">&#39;dicts&#39;</span> <span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]},</span> <span class="p">{</span><span class="s1">&#39;B&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]},</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">]}]})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>list</th>
      <th>tuple</th>
      <th>set</th>
      <th>dicts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[1, 2]</td>
      <td>(a, b)</td>
      <td>{C, B, A}</td>
      <td>{'A': [1, 2, 3]}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[3, 4]</td>
      <td>(c, d)</td>
      <td>{E, D}</td>
      <td>{'B': [5, 6, 8]}</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[5, 6]</td>
      <td>(e, f)</td>
      <td>{F}</td>
      <td>{'C': [3, 9]}</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="working-with-a-dataframe">
<h4>Working with a DataFrame<a class="headerlink" href="#working-with-a-dataframe" title="Permalink to this headline">¶</a></h4>
<p>You can extract particular columns of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by name</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    yes
1     no
2     no
3    yes
4     no
Name: E, dtype: category
Categories (2, object): [&#39;no&#39;, &#39;yes&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.958092
1    0.883201
2    0.295432
3    0.512376
4    0.088702
Name: B, dtype: float64
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>There is also a shortcut for accessing single columns, using Python’s dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>) notation.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.958092
1    0.883201
2    0.295432
3    0.512376
4    0.088702
Name: B, dtype: float64
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>This notation can be more convenient if we need to perform operations on a single column. If we want to extract multiple columns, this notation will not work. Also, if we want to create new columns or replace existing columns, we need to use the array notation with the column name in quotes.</p>
</div></blockquote>
<p>Let’s look at slicing a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</div>
<div class="section" id="extracting-rows-and-columns">
<h4>Extracting rows and columns<a class="headerlink" href="#extracting-rows-and-columns" title="Permalink to this headline">¶</a></h4>
<p>There are two extractor functions in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">loc</span></code> extracts by label (index label, column label, slice of labels, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iloc</span></code> extracts by index (integers, slice objects, etc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span> 
                  <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">],</span>
                  <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">,</span><span class="s1">&#39;four&#39;</span><span class="p">])</span>
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>First, let’s see what naively slicing this <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> does.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    5
b    9
c    8
d    5
e    6
Name: one, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Ok, that works. It grabs one column from the dataset. How about the dot notation?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">one</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    5
b    9
c    8
d    5
e    6
Name: one, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Let’s see what this produces.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">one</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.series.Series
</pre></div>
</div>
</div>
</div>
<p>So this is a series, so we can potentially do slicing of this series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">one</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">one</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b    9
c    8
d    5
Name: one, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">one</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    5
b    9
c    8
Name: one, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Ok, so we have all the <code class="docutils literal notranslate"><span class="pre">Series</span></code> slicing available. The problem here is in semantics, in that we are grabbing one column and then slicing the rows. That doesn’t quite work with our sense that a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is a rectangle with rows and columns, and we tend to think of rows, then columns.</p>
<p>Let’s see if we can do column slicing with this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[:</span><span class="s1">&#39;two&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>That’s not what we want, of course. It’s giving back the entire data frame. We’ll come back to this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>three</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>7</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>That works correctly though. We can give a list of column names. Ok.</p>
<p>How about row slices?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#df2[&#39;a&#39;] # Doesn&#39;t work</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Ok, that works. It slices rows, but includes the largest index, like a <code class="docutils literal notranslate"><span class="pre">Series</span></code> but unlike <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Slices by location work too, but use the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> slicing rules.</p>
<p>This entire extraction method becomes confusing. Let’s simplify things for this, and then move on to more consistent ways to extract elements of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Let’s agree on two things. If we’re going the direct extraction route,</p>
<ol class="simple">
<li><p>We will extract single columns of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with <code class="docutils literal notranslate"><span class="pre">[]</span></code> or <code class="docutils literal notranslate"><span class="pre">.</span></code>, i.e., <code class="docutils literal notranslate"><span class="pre">df2['one']</span></code> or <code class="docutils literal notranslate"><span class="pre">df2.one</span></code></p></li>
<li><p>We will extract slices of rows of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> using location only, i.e., <code class="docutils literal notranslate"><span class="pre">df2[:3]</span></code>.</p></li>
</ol>
<p>For everything else, we’ll use two functions, <code class="docutils literal notranslate"><span class="pre">loc</span></code> and <code class="docutils literal notranslate"><span class="pre">iloc</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">loc</span></code> extracts elements like a matrix, using index and columns</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iloc</span></code> extracts elements like a matrix, using location</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;one&#39;</span><span class="p">:</span><span class="s1">&#39;three&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;d&#39;</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">loc</span></code> works just like a matrix, but with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> slicing rules (include largest index)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">iloc</span></code> slices like a matrix, but uses <code class="docutils literal notranslate"><span class="pre">numpy</span></code> slicing conventions (does <strong>not</strong> include highest index)</p>
<p>If we want to extract a single element from a dataset, there are two functions available, <code class="docutils literal notranslate"><span class="pre">iat</span></code> and <code class="docutils literal notranslate"><span class="pre">at</span></code>, with behavior corresponding to <code class="docutils literal notranslate"><span class="pre">iloc</span></code> and <code class="docutils literal notranslate"><span class="pre">loc</span></code>, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="boolean-selection">
<h4>Boolean selection<a class="headerlink" href="#boolean-selection" title="Permalink to this headline">¶</a></h4>
<p>We can also use tests to extract data from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. For example, we can extract only rows where column labeled <code class="docutils literal notranslate"><span class="pre">one</span></code> is greater than 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="o">.</span><span class="n">one</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can also do composite tests. Here we ask for rows where <code class="docutils literal notranslate"><span class="pre">one</span></code> is greater than 3 and <code class="docutils literal notranslate"><span class="pre">three</span></code> is less than 9</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[(</span><span class="n">df2</span><span class="o">.</span><span class="n">one</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">three</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="query">
<h4><code class="docutils literal notranslate"><span class="pre">query</span></code><a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>’s have a <code class="docutils literal notranslate"><span class="pre">query</span></code> method allowing selection using a Python expression</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.006644</td>
      <td>0.132488</td>
      <td>0.923696</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.761261</td>
      <td>0.301631</td>
      <td>0.217565</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.681122</td>
      <td>0.776537</td>
      <td>0.088091</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.765943</td>
      <td>0.405494</td>
      <td>0.494623</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.321990</td>
      <td>0.018481</td>
      <td>0.460912</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.256564</td>
      <td>0.376117</td>
      <td>0.595307</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.087338</td>
      <td>0.658817</td>
      <td>0.114891</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.565454</td>
      <td>0.758168</td>
      <td>0.859863</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.592381</td>
      <td>0.538215</td>
      <td>0.158686</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.527897</td>
      <td>0.495412</td>
      <td>0.395234</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">c</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.006644</td>
      <td>0.132488</td>
      <td>0.923696</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.256564</td>
      <td>0.376117</td>
      <td>0.595307</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.565454</td>
      <td>0.758168</td>
      <td>0.859863</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can equivalently write this query as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(a &lt; b) &amp; (b &lt; c)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.006644</td>
      <td>0.132488</td>
      <td>0.923696</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.256564</td>
      <td>0.376117</td>
      <td>0.595307</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.565454</td>
      <td>0.758168</td>
      <td>0.859863</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="replacing-values-in-a-dataframe">
<h4>Replacing values in a DataFrame<a class="headerlink" href="#replacing-values-in-a-dataframe" title="Permalink to this headline">¶</a></h4>
<p>We can replace values within a DataFrame either by position or using a query.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>5</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span> <span class="c1"># missing value</span>
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>5</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>-9</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s now replace values using <code class="docutils literal notranslate"><span class="pre">replace</span></code> which is more flexible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span> <span class="c1"># replace 0 with -9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>5</td>
      <td>3</td>
      <td>-9</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>-9</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">2</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mf">6.5</span><span class="p">})</span> <span class="c1"># multiple replacements</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2.5</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>b</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2.5</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>-9.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>5.0</td>
      <td>2.5</td>
      <td>7.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2.5</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>7.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">5</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">800</span><span class="p">}})</span> 
<span class="c1"># different replacements in different columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>b</th>
      <td>500</td>
      <td>3</td>
      <td>-9</td>
      <td>5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>-9</td>
    </tr>
    <tr>
      <th>d</th>
      <td>500</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2</td>
      <td>7</td>
      <td>800</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>See more examples in the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html?highlight=replace#pandas.DataFrame.replace">documentation</a></p>
</div>
</div>
<div class="section" id="categorical-data">
<h3>Categorical data<a class="headerlink" href="#categorical-data" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> provides a <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> function and a <code class="docutils literal notranslate"><span class="pre">category</span></code> object type to Python. This type is analogous to the <code class="docutils literal notranslate"><span class="pre">factor</span></code> data type in R. It is meant to address categorical or discrete variables, where we need to use them in analyses. Categorical variables typically take on a small number of unique values, like gender, blood type, country of origin, race, etc.</p>
<p>You can create categorical <code class="docutils literal notranslate"><span class="pre">Series</span></code> in a couple of ways:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="mf">3.</span><span class="p">,</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20200512&#39;</span><span class="p">),</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="s1">&#39;NIH&#39;</span><span class="p">})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    NIH
1    NIH
2    NIH
3    NIH
4    NIH
Name: F, dtype: category
Categories (1, object): [&#39;NIH&#39;]
</pre></div>
</div>
</div>
</div>
<p>You can also create <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>’s where each column is categorical</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">),</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bdca&#39;</span><span class="p">)})</span>
<span class="n">df_cat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df_cat</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A    category
B    category
dtype: object
</pre></div>
</div>
</div>
</div>
<p>You can explore categorical data in a variety of ways</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cat</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count     4
unique    4
top       a
freq      1
Name: A, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    1
b    1
c    1
d    1
Name: A, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>One issue with categories is that, if a particular level of a category is not seen before, it can create an error. So you can pre-specify the categories you expect</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cat</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;aabb&#39;</span><span class="p">),</span> <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
<span class="n">df_cat</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    2
b    2
c    0
d    0
Name: B, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="section" id="re-organizing-categories">
<h4>Re-organizing categories<a class="headerlink" href="#re-organizing-categories" title="Permalink to this headline">¶</a></h4>
<p>In categorical data, there is often the concept of a “first” or “reference” category, and an ordering of categories. This tends to be important in both visualization as well as in regression modeling. Both aspects of a category can be addressed using the <code class="docutils literal notranslate"><span class="pre">reorder_categories</span></code> function.</p>
<p>In our earlier example, we can see that the <code class="docutils literal notranslate"><span class="pre">A</span></code> variable has 4 categories, with the “first” category being “a”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cat</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    a
1    b
2    c
3    d
Name: A, dtype: category
Categories (4, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]
</pre></div>
</div>
</div>
</div>
<p>Suppose we want to change this ordering to the reverse ordering, where
“d” is the “first” category, and then it goes in reverse order.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cat</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cat</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="n">df_cat</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    a
1    b
2    c
3    d
Name: A, dtype: category
Categories (4, object): [&#39;d&#39;, &#39;c&#39;, &#39;b&#39;, &#39;a&#39;]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="missing-data">
<h3>Missing data<a class="headerlink" href="#missing-data" title="Permalink to this headline">¶</a></h3>
<p>Both <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> allow for missing values, which are a reality in data science. The missing values are coded as <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>. Let’s create some data and force some missing values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">])</span> <span class="c1"># pre-specify index and column names</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;four&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># add a column named &quot;four&quot;, which will all be 20</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;five&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
      <th>five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.237807</td>
      <td>-0.719080</td>
      <td>0.340146</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>c</th>
      <td>0.542306</td>
      <td>-0.119726</td>
      <td>-1.423387</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2.127543</td>
      <td>0.681932</td>
      <td>1.149117</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>f</th>
      <td>-0.453755</td>
      <td>1.662654</td>
      <td>-1.918944</td>
      <td>20</td>
      <td>False</td>
    </tr>
    <tr>
      <th>g</th>
      <td>0.873007</td>
      <td>-1.435325</td>
      <td>1.347852</td>
      <td>20</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">])</span>
<span class="n">df2</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;background-color:yellow&#39;</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_6b570_row1_col0, #T_6b570_row1_col1, #T_6b570_row1_col2, #T_6b570_row1_col3, #T_6b570_row1_col4, #T_6b570_row3_col0, #T_6b570_row3_col1, #T_6b570_row3_col2, #T_6b570_row3_col3, #T_6b570_row3_col4 {
  background-color: yellow;
}
</style>
<table id="T_6b570_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >one</th>
      <th class="col_heading level0 col1" >two</th>
      <th class="col_heading level0 col2" >three</th>
      <th class="col_heading level0 col3" >four</th>
      <th class="col_heading level0 col4" >five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_6b570_level0_row0" class="row_heading level0 row0" >a</th>
      <td id="T_6b570_row0_col0" class="data row0 col0" >0.237807</td>
      <td id="T_6b570_row0_col1" class="data row0 col1" >-0.719080</td>
      <td id="T_6b570_row0_col2" class="data row0 col2" >0.340146</td>
      <td id="T_6b570_row0_col3" class="data row0 col3" >20.000000</td>
      <td id="T_6b570_row0_col4" class="data row0 col4" >True</td>
    </tr>
    <tr>
      <th id="T_6b570_level0_row1" class="row_heading level0 row1" >b</th>
      <td id="T_6b570_row1_col0" class="data row1 col0" >nan</td>
      <td id="T_6b570_row1_col1" class="data row1 col1" >nan</td>
      <td id="T_6b570_row1_col2" class="data row1 col2" >nan</td>
      <td id="T_6b570_row1_col3" class="data row1 col3" >nan</td>
      <td id="T_6b570_row1_col4" class="data row1 col4" >nan</td>
    </tr>
    <tr>
      <th id="T_6b570_level0_row2" class="row_heading level0 row2" >c</th>
      <td id="T_6b570_row2_col0" class="data row2 col0" >0.542306</td>
      <td id="T_6b570_row2_col1" class="data row2 col1" >-0.119726</td>
      <td id="T_6b570_row2_col2" class="data row2 col2" >-1.423387</td>
      <td id="T_6b570_row2_col3" class="data row2 col3" >20.000000</td>
      <td id="T_6b570_row2_col4" class="data row2 col4" >True</td>
    </tr>
    <tr>
      <th id="T_6b570_level0_row3" class="row_heading level0 row3" >d</th>
      <td id="T_6b570_row3_col0" class="data row3 col0" >nan</td>
      <td id="T_6b570_row3_col1" class="data row3 col1" >nan</td>
      <td id="T_6b570_row3_col2" class="data row3 col2" >nan</td>
      <td id="T_6b570_row3_col3" class="data row3 col3" >nan</td>
      <td id="T_6b570_row3_col4" class="data row3 col4" >nan</td>
    </tr>
    <tr>
      <th id="T_6b570_level0_row4" class="row_heading level0 row4" >e</th>
      <td id="T_6b570_row4_col0" class="data row4 col0" >2.127543</td>
      <td id="T_6b570_row4_col1" class="data row4 col1" >0.681932</td>
      <td id="T_6b570_row4_col2" class="data row4 col2" >1.149117</td>
      <td id="T_6b570_row4_col3" class="data row4 col3" >20.000000</td>
      <td id="T_6b570_row4_col4" class="data row4 col4" >True</td>
    </tr>
    <tr>
      <th id="T_6b570_level0_row5" class="row_heading level0 row5" >f</th>
      <td id="T_6b570_row5_col0" class="data row5 col0" >-0.453755</td>
      <td id="T_6b570_row5_col1" class="data row5 col1" >1.662654</td>
      <td id="T_6b570_row5_col2" class="data row5 col2" >-1.918944</td>
      <td id="T_6b570_row5_col3" class="data row5 col3" >20.000000</td>
      <td id="T_6b570_row5_col4" class="data row5 col4" >False</td>
    </tr>
    <tr>
      <th id="T_6b570_level0_row6" class="row_heading level0 row6" >g</th>
      <td id="T_6b570_row6_col0" class="data row6 col0" >0.873007</td>
      <td id="T_6b570_row6_col1" class="data row6 col1" >-1.435325</td>
      <td id="T_6b570_row6_col2" class="data row6 col2" >1.347852</td>
      <td id="T_6b570_row6_col3" class="data row6 col3" >20.000000</td>
      <td id="T_6b570_row6_col4" class="data row6 col4" >True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The code above is creating new blank rows based on the new index values, some of which are present in the existing data and some of which are missing.</p>
<p>We can create <em>masks</em> of the data indicating where missing values reside in a data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
      <th>five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>b</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>c</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>d</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>e</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>f</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>g</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a     True
b    False
c     True
d    False
e     True
f     True
g     True
Name: one, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>We can obtain complete data by dropping any row that has any missing value. This is called <em>complete case analysis</em>, and you should be very careful using it. It is <em>only</em> valid if we belive that the missingness is missing at random, and not related to some characteristic of the data or the data gathering process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
      <th>five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.237807</td>
      <td>-0.719080</td>
      <td>0.340146</td>
      <td>20.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>c</th>
      <td>0.542306</td>
      <td>-0.119726</td>
      <td>-1.423387</td>
      <td>20.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2.127543</td>
      <td>0.681932</td>
      <td>1.149117</td>
      <td>20.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>f</th>
      <td>-0.453755</td>
      <td>1.662654</td>
      <td>-1.918944</td>
      <td>20.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>g</th>
      <td>0.873007</td>
      <td>-1.435325</td>
      <td>1.347852</td>
      <td>20.0</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can also fill in, or <em>impute</em>, missing values. This can be done using a single value..</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out1</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">out1</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;background-color:yellow&#39;</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_d14fc_row1_col0, #T_d14fc_row1_col1, #T_d14fc_row1_col2, #T_d14fc_row1_col3, #T_d14fc_row1_col4, #T_d14fc_row3_col0, #T_d14fc_row3_col1, #T_d14fc_row3_col2, #T_d14fc_row3_col3, #T_d14fc_row3_col4 {
  background-color: yellow;
}
</style>
<table id="T_d14fc_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >one</th>
      <th class="col_heading level0 col1" >two</th>
      <th class="col_heading level0 col2" >three</th>
      <th class="col_heading level0 col3" >four</th>
      <th class="col_heading level0 col4" >five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_d14fc_level0_row0" class="row_heading level0 row0" >a</th>
      <td id="T_d14fc_row0_col0" class="data row0 col0" >0.237807</td>
      <td id="T_d14fc_row0_col1" class="data row0 col1" >-0.719080</td>
      <td id="T_d14fc_row0_col2" class="data row0 col2" >0.340146</td>
      <td id="T_d14fc_row0_col3" class="data row0 col3" >20.000000</td>
      <td id="T_d14fc_row0_col4" class="data row0 col4" >True</td>
    </tr>
    <tr>
      <th id="T_d14fc_level0_row1" class="row_heading level0 row1" >b</th>
      <td id="T_d14fc_row1_col0" class="data row1 col0" >5.000000</td>
      <td id="T_d14fc_row1_col1" class="data row1 col1" >5.000000</td>
      <td id="T_d14fc_row1_col2" class="data row1 col2" >5.000000</td>
      <td id="T_d14fc_row1_col3" class="data row1 col3" >5.000000</td>
      <td id="T_d14fc_row1_col4" class="data row1 col4" >5</td>
    </tr>
    <tr>
      <th id="T_d14fc_level0_row2" class="row_heading level0 row2" >c</th>
      <td id="T_d14fc_row2_col0" class="data row2 col0" >0.542306</td>
      <td id="T_d14fc_row2_col1" class="data row2 col1" >-0.119726</td>
      <td id="T_d14fc_row2_col2" class="data row2 col2" >-1.423387</td>
      <td id="T_d14fc_row2_col3" class="data row2 col3" >20.000000</td>
      <td id="T_d14fc_row2_col4" class="data row2 col4" >True</td>
    </tr>
    <tr>
      <th id="T_d14fc_level0_row3" class="row_heading level0 row3" >d</th>
      <td id="T_d14fc_row3_col0" class="data row3 col0" >5.000000</td>
      <td id="T_d14fc_row3_col1" class="data row3 col1" >5.000000</td>
      <td id="T_d14fc_row3_col2" class="data row3 col2" >5.000000</td>
      <td id="T_d14fc_row3_col3" class="data row3 col3" >5.000000</td>
      <td id="T_d14fc_row3_col4" class="data row3 col4" >5</td>
    </tr>
    <tr>
      <th id="T_d14fc_level0_row4" class="row_heading level0 row4" >e</th>
      <td id="T_d14fc_row4_col0" class="data row4 col0" >2.127543</td>
      <td id="T_d14fc_row4_col1" class="data row4 col1" >0.681932</td>
      <td id="T_d14fc_row4_col2" class="data row4 col2" >1.149117</td>
      <td id="T_d14fc_row4_col3" class="data row4 col3" >20.000000</td>
      <td id="T_d14fc_row4_col4" class="data row4 col4" >True</td>
    </tr>
    <tr>
      <th id="T_d14fc_level0_row5" class="row_heading level0 row5" >f</th>
      <td id="T_d14fc_row5_col0" class="data row5 col0" >-0.453755</td>
      <td id="T_d14fc_row5_col1" class="data row5 col1" >1.662654</td>
      <td id="T_d14fc_row5_col2" class="data row5 col2" >-1.918944</td>
      <td id="T_d14fc_row5_col3" class="data row5 col3" >20.000000</td>
      <td id="T_d14fc_row5_col4" class="data row5 col4" >False</td>
    </tr>
    <tr>
      <th id="T_d14fc_level0_row6" class="row_heading level0 row6" >g</th>
      <td id="T_d14fc_row6_col0" class="data row6 col0" >0.873007</td>
      <td id="T_d14fc_row6_col1" class="data row6 col1" >-1.435325</td>
      <td id="T_d14fc_row6_col2" class="data row6 col2" >1.347852</td>
      <td id="T_d14fc_row6_col3" class="data row6 col3" >20.000000</td>
      <td id="T_d14fc_row6_col4" class="data row6 col4" >True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>or a computed value like a column mean</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span>   <span class="c1"># remove non-numeric columns</span>
<span class="n">out2</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>  <span class="c1"># df3.mean() computes column-wise means</span>

<span class="n">out2</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;background-color:yellow&#39;</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_15460_row1_col0, #T_15460_row1_col1, #T_15460_row1_col2, #T_15460_row1_col3, #T_15460_row3_col0, #T_15460_row3_col1, #T_15460_row3_col2, #T_15460_row3_col3 {
  background-color: yellow;
}
</style>
<table id="T_15460_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >one</th>
      <th class="col_heading level0 col1" >two</th>
      <th class="col_heading level0 col2" >three</th>
      <th class="col_heading level0 col3" >four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_15460_level0_row0" class="row_heading level0 row0" >a</th>
      <td id="T_15460_row0_col0" class="data row0 col0" >0.237807</td>
      <td id="T_15460_row0_col1" class="data row0 col1" >-0.719080</td>
      <td id="T_15460_row0_col2" class="data row0 col2" >0.340146</td>
      <td id="T_15460_row0_col3" class="data row0 col3" >20.000000</td>
    </tr>
    <tr>
      <th id="T_15460_level0_row1" class="row_heading level0 row1" >b</th>
      <td id="T_15460_row1_col0" class="data row1 col0" >0.665382</td>
      <td id="T_15460_row1_col1" class="data row1 col1" >0.014091</td>
      <td id="T_15460_row1_col2" class="data row1 col2" >-0.101043</td>
      <td id="T_15460_row1_col3" class="data row1 col3" >20.000000</td>
    </tr>
    <tr>
      <th id="T_15460_level0_row2" class="row_heading level0 row2" >c</th>
      <td id="T_15460_row2_col0" class="data row2 col0" >0.542306</td>
      <td id="T_15460_row2_col1" class="data row2 col1" >-0.119726</td>
      <td id="T_15460_row2_col2" class="data row2 col2" >-1.423387</td>
      <td id="T_15460_row2_col3" class="data row2 col3" >20.000000</td>
    </tr>
    <tr>
      <th id="T_15460_level0_row3" class="row_heading level0 row3" >d</th>
      <td id="T_15460_row3_col0" class="data row3 col0" >0.665382</td>
      <td id="T_15460_row3_col1" class="data row3 col1" >0.014091</td>
      <td id="T_15460_row3_col2" class="data row3 col2" >-0.101043</td>
      <td id="T_15460_row3_col3" class="data row3 col3" >20.000000</td>
    </tr>
    <tr>
      <th id="T_15460_level0_row4" class="row_heading level0 row4" >e</th>
      <td id="T_15460_row4_col0" class="data row4 col0" >2.127543</td>
      <td id="T_15460_row4_col1" class="data row4 col1" >0.681932</td>
      <td id="T_15460_row4_col2" class="data row4 col2" >1.149117</td>
      <td id="T_15460_row4_col3" class="data row4 col3" >20.000000</td>
    </tr>
    <tr>
      <th id="T_15460_level0_row5" class="row_heading level0 row5" >f</th>
      <td id="T_15460_row5_col0" class="data row5 col0" >-0.453755</td>
      <td id="T_15460_row5_col1" class="data row5 col1" >1.662654</td>
      <td id="T_15460_row5_col2" class="data row5 col2" >-1.918944</td>
      <td id="T_15460_row5_col3" class="data row5 col3" >20.000000</td>
    </tr>
    <tr>
      <th id="T_15460_level0_row6" class="row_heading level0 row6" >g</th>
      <td id="T_15460_row6_col0" class="data row6 col0" >0.873007</td>
      <td id="T_15460_row6_col1" class="data row6 col1" >-1.435325</td>
      <td id="T_15460_row6_col2" class="data row6 col2" >1.347852</td>
      <td id="T_15460_row6_col3" class="data row6 col3" >20.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>You can also impute based on the principle of <em>last value carried forward</em> which is common in time series. This means that the missing value is imputed with the previous recorded value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out3</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;ffill&#39;</span><span class="p">)</span> <span class="c1"># Fill forward</span>

<span class="n">out3</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;background-color:yellow&#39;</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_40f53_row1_col0, #T_40f53_row1_col1, #T_40f53_row1_col2, #T_40f53_row1_col3, #T_40f53_row1_col4, #T_40f53_row3_col0, #T_40f53_row3_col1, #T_40f53_row3_col2, #T_40f53_row3_col3, #T_40f53_row3_col4 {
  background-color: yellow;
}
</style>
<table id="T_40f53_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >one</th>
      <th class="col_heading level0 col1" >two</th>
      <th class="col_heading level0 col2" >three</th>
      <th class="col_heading level0 col3" >four</th>
      <th class="col_heading level0 col4" >five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_40f53_level0_row0" class="row_heading level0 row0" >a</th>
      <td id="T_40f53_row0_col0" class="data row0 col0" >0.237807</td>
      <td id="T_40f53_row0_col1" class="data row0 col1" >-0.719080</td>
      <td id="T_40f53_row0_col2" class="data row0 col2" >0.340146</td>
      <td id="T_40f53_row0_col3" class="data row0 col3" >20.000000</td>
      <td id="T_40f53_row0_col4" class="data row0 col4" >True</td>
    </tr>
    <tr>
      <th id="T_40f53_level0_row1" class="row_heading level0 row1" >b</th>
      <td id="T_40f53_row1_col0" class="data row1 col0" >0.237807</td>
      <td id="T_40f53_row1_col1" class="data row1 col1" >-0.719080</td>
      <td id="T_40f53_row1_col2" class="data row1 col2" >0.340146</td>
      <td id="T_40f53_row1_col3" class="data row1 col3" >20.000000</td>
      <td id="T_40f53_row1_col4" class="data row1 col4" >True</td>
    </tr>
    <tr>
      <th id="T_40f53_level0_row2" class="row_heading level0 row2" >c</th>
      <td id="T_40f53_row2_col0" class="data row2 col0" >0.542306</td>
      <td id="T_40f53_row2_col1" class="data row2 col1" >-0.119726</td>
      <td id="T_40f53_row2_col2" class="data row2 col2" >-1.423387</td>
      <td id="T_40f53_row2_col3" class="data row2 col3" >20.000000</td>
      <td id="T_40f53_row2_col4" class="data row2 col4" >True</td>
    </tr>
    <tr>
      <th id="T_40f53_level0_row3" class="row_heading level0 row3" >d</th>
      <td id="T_40f53_row3_col0" class="data row3 col0" >0.542306</td>
      <td id="T_40f53_row3_col1" class="data row3 col1" >-0.119726</td>
      <td id="T_40f53_row3_col2" class="data row3 col2" >-1.423387</td>
      <td id="T_40f53_row3_col3" class="data row3 col3" >20.000000</td>
      <td id="T_40f53_row3_col4" class="data row3 col4" >True</td>
    </tr>
    <tr>
      <th id="T_40f53_level0_row4" class="row_heading level0 row4" >e</th>
      <td id="T_40f53_row4_col0" class="data row4 col0" >2.127543</td>
      <td id="T_40f53_row4_col1" class="data row4 col1" >0.681932</td>
      <td id="T_40f53_row4_col2" class="data row4 col2" >1.149117</td>
      <td id="T_40f53_row4_col3" class="data row4 col3" >20.000000</td>
      <td id="T_40f53_row4_col4" class="data row4 col4" >True</td>
    </tr>
    <tr>
      <th id="T_40f53_level0_row5" class="row_heading level0 row5" >f</th>
      <td id="T_40f53_row5_col0" class="data row5 col0" >-0.453755</td>
      <td id="T_40f53_row5_col1" class="data row5 col1" >1.662654</td>
      <td id="T_40f53_row5_col2" class="data row5 col2" >-1.918944</td>
      <td id="T_40f53_row5_col3" class="data row5 col3" >20.000000</td>
      <td id="T_40f53_row5_col4" class="data row5 col4" >False</td>
    </tr>
    <tr>
      <th id="T_40f53_level0_row6" class="row_heading level0 row6" >g</th>
      <td id="T_40f53_row6_col0" class="data row6 col0" >0.873007</td>
      <td id="T_40f53_row6_col1" class="data row6 col1" >-1.435325</td>
      <td id="T_40f53_row6_col2" class="data row6 col2" >1.347852</td>
      <td id="T_40f53_row6_col3" class="data row6 col3" >20.000000</td>
      <td id="T_40f53_row6_col4" class="data row6 col4" >True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out4</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;bfill&#39;</span><span class="p">)</span> <span class="c1"># Fill backward</span>

<span class="n">out4</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;background-color:yellow&#39;</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_00fd8_row1_col0, #T_00fd8_row1_col1, #T_00fd8_row1_col2, #T_00fd8_row1_col3, #T_00fd8_row1_col4, #T_00fd8_row3_col0, #T_00fd8_row3_col1, #T_00fd8_row3_col2, #T_00fd8_row3_col3, #T_00fd8_row3_col4 {
  background-color: yellow;
}
</style>
<table id="T_00fd8_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >one</th>
      <th class="col_heading level0 col1" >two</th>
      <th class="col_heading level0 col2" >three</th>
      <th class="col_heading level0 col3" >four</th>
      <th class="col_heading level0 col4" >five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_00fd8_level0_row0" class="row_heading level0 row0" >a</th>
      <td id="T_00fd8_row0_col0" class="data row0 col0" >0.237807</td>
      <td id="T_00fd8_row0_col1" class="data row0 col1" >-0.719080</td>
      <td id="T_00fd8_row0_col2" class="data row0 col2" >0.340146</td>
      <td id="T_00fd8_row0_col3" class="data row0 col3" >20.000000</td>
      <td id="T_00fd8_row0_col4" class="data row0 col4" >True</td>
    </tr>
    <tr>
      <th id="T_00fd8_level0_row1" class="row_heading level0 row1" >b</th>
      <td id="T_00fd8_row1_col0" class="data row1 col0" >0.542306</td>
      <td id="T_00fd8_row1_col1" class="data row1 col1" >-0.119726</td>
      <td id="T_00fd8_row1_col2" class="data row1 col2" >-1.423387</td>
      <td id="T_00fd8_row1_col3" class="data row1 col3" >20.000000</td>
      <td id="T_00fd8_row1_col4" class="data row1 col4" >True</td>
    </tr>
    <tr>
      <th id="T_00fd8_level0_row2" class="row_heading level0 row2" >c</th>
      <td id="T_00fd8_row2_col0" class="data row2 col0" >0.542306</td>
      <td id="T_00fd8_row2_col1" class="data row2 col1" >-0.119726</td>
      <td id="T_00fd8_row2_col2" class="data row2 col2" >-1.423387</td>
      <td id="T_00fd8_row2_col3" class="data row2 col3" >20.000000</td>
      <td id="T_00fd8_row2_col4" class="data row2 col4" >True</td>
    </tr>
    <tr>
      <th id="T_00fd8_level0_row3" class="row_heading level0 row3" >d</th>
      <td id="T_00fd8_row3_col0" class="data row3 col0" >2.127543</td>
      <td id="T_00fd8_row3_col1" class="data row3 col1" >0.681932</td>
      <td id="T_00fd8_row3_col2" class="data row3 col2" >1.149117</td>
      <td id="T_00fd8_row3_col3" class="data row3 col3" >20.000000</td>
      <td id="T_00fd8_row3_col4" class="data row3 col4" >True</td>
    </tr>
    <tr>
      <th id="T_00fd8_level0_row4" class="row_heading level0 row4" >e</th>
      <td id="T_00fd8_row4_col0" class="data row4 col0" >2.127543</td>
      <td id="T_00fd8_row4_col1" class="data row4 col1" >0.681932</td>
      <td id="T_00fd8_row4_col2" class="data row4 col2" >1.149117</td>
      <td id="T_00fd8_row4_col3" class="data row4 col3" >20.000000</td>
      <td id="T_00fd8_row4_col4" class="data row4 col4" >True</td>
    </tr>
    <tr>
      <th id="T_00fd8_level0_row5" class="row_heading level0 row5" >f</th>
      <td id="T_00fd8_row5_col0" class="data row5 col0" >-0.453755</td>
      <td id="T_00fd8_row5_col1" class="data row5 col1" >1.662654</td>
      <td id="T_00fd8_row5_col2" class="data row5 col2" >-1.918944</td>
      <td id="T_00fd8_row5_col3" class="data row5 col3" >20.000000</td>
      <td id="T_00fd8_row5_col4" class="data row5 col4" >False</td>
    </tr>
    <tr>
      <th id="T_00fd8_level0_row6" class="row_heading level0 row6" >g</th>
      <td id="T_00fd8_row6_col0" class="data row6 col0" >0.873007</td>
      <td id="T_00fd8_row6_col1" class="data row6 col1" >-1.435325</td>
      <td id="T_00fd8_row6_col2" class="data row6 col2" >1.347852</td>
      <td id="T_00fd8_row6_col3" class="data row6 col3" >20.000000</td>
      <td id="T_00fd8_row6_col4" class="data row6 col4" >True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="data-transformation">
<h2>Data transformation<a class="headerlink" href="#data-transformation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="arithmetic-operations">
<h3>Arithmetic operations<a class="headerlink" href="#arithmetic-operations" title="Permalink to this headline">¶</a></h3>
<p>If you have a <code class="docutils literal notranslate"><span class="pre">Series</span></code> or <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> that is all numeric, you can add or multiply single numbers to all the elements together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          0         1         2         3         4
0  1.237322 -3.107655  1.157709  0.144998  2.519612
1 -0.556125  0.129295 -0.779568 -1.321480  2.005993
2 -0.459088 -0.296450 -0.020454  0.202721 -0.772637
3  0.555346 -0.747807  0.421822 -1.129676  0.296860
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          0         1         2         3         4
0  7.237322  2.892345  7.157709  6.144998  8.519612
1  5.443875  6.129295  5.220432  4.678520  8.005993
2  5.540912  5.703550  5.979546  6.202721  5.227363
3  6.555346  5.252193  6.421822  4.870324  6.296860
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           0          1          2          3          4
0 -12.373221  31.076554 -11.577089  -1.449976 -25.196117
1   5.561250  -1.292950   7.795683  13.214797 -20.059926
2   4.590877   2.964501   0.204541  -2.027212   7.726367
3  -5.553464   7.478066  -4.218220  11.296764  -2.968601
</pre></div>
</div>
</div>
</div>
<p>If you have two compatible (same dimension) numeric <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>s, you can add, subtract, multiply and divide elementwise</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          0         1         2         3         4
0  4.559751 -0.101516  3.814203  3.097577  5.310886
1  5.358271  4.017358  2.032890  1.854618  6.096397
2  3.474003  3.593137  2.600547  4.617792  3.241860
3  3.902699  3.695498  5.365292  1.872476  3.409339
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          0         1         2         3         4
0  4.110915 -9.342044  3.075447  0.428117  7.032928
1 -3.289143  0.502707 -2.192503 -4.197149  8.205321
2 -1.805634 -1.153068 -0.053610  0.895028 -3.101747
3  1.858940 -3.322732  2.085265 -3.391461  0.923971
</pre></div>
</div>
</div>
</div>
<p>If you have a <code class="docutils literal notranslate"><span class="pre">Series</span></code> with the same number of elements as the number of columns of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, you can do arithmetic operations, with each element of the <code class="docutils literal notranslate"><span class="pre">Series</span></code> acting upon each column of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          0         1         2         3         4
0  2.237322 -1.107655  4.157709  4.144998  7.519612
1  0.443875  2.129295  2.220432  2.678520  7.005993
2  0.540912  1.703550  2.979546  4.202721  4.227363
3  1.555346  1.252193  3.421822  2.870324  5.296860
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          0         1         2         3          4
0  1.237322 -6.215311  3.473127  0.579990  12.598058
1 -0.556125  0.258590 -2.338705 -5.285919  10.029963
2 -0.459088 -0.592900 -0.061362  0.810885  -3.863183
3  0.555346 -1.495613  1.265466 -4.518706   1.484300
</pre></div>
</div>
</div>
</div>
<p>This idea can be used to standardize a dataset, i.e. make each column have mean 0 and standard deviation 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">means</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stds</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">means</span><span class="p">)</span><span class="o">/</span><span class="n">stds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.215621</td>
      <td>-1.453292</td>
      <td>1.186825</td>
      <td>0.826084</td>
      <td>0.989690</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.874733</td>
      <td>0.784687</td>
      <td>-1.201141</td>
      <td>-0.979716</td>
      <td>0.652416</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.761631</td>
      <td>0.490333</td>
      <td>-0.265426</td>
      <td>0.897164</td>
      <td>-1.172202</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.420743</td>
      <td>0.178272</td>
      <td>0.279741</td>
      <td>-0.743532</td>
      <td>-0.469905</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="concatenation-of-data-sets">
<h3>Concatenation of data sets<a class="headerlink" href="#concatenation-of-data-sets" title="Permalink to this headline">¶</a></h3>
<p>Let’s create some example data sets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]})</span>

<span class="n">df2</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)],</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)]})</span>
<span class="n">df3</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)],</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)]})</span>
</pre></div>
</div>
</div>
</div>
<p>We can concatenate these <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects by row</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_concatenate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">row_concatenate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     A    B    C    D
0   a0   b0   c0   d0
1   a1   b1   c1   d1
2   a2   b2   c2   d2
3   a3   b3   c3   d3
0   a4   b4   c4   d4
1   a5   b5   c5   d5
2   a6   b6   c6   d6
3   a7   b7   c7   d7
0   a8   b8   c8   d8
1   a9   b9   c9   d9
2  a10  b10  c10  d10
3  a11  b11  c11  d11
</pre></div>
</div>
</div>
</div>
<p>This stacks the dataframes together. They are literally stacked, as is evidenced by the index values being repeated.</p>
<p>This same exercise can be done by the <code class="docutils literal notranslate"><span class="pre">append</span></code> function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>b0</td>
      <td>c0</td>
      <td>d0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>b1</td>
      <td>c1</td>
      <td>d1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>b2</td>
      <td>c2</td>
      <td>d2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>b3</td>
      <td>c3</td>
      <td>d3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>a4</td>
      <td>b4</td>
      <td>c4</td>
      <td>d4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a5</td>
      <td>b5</td>
      <td>c5</td>
      <td>d5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a6</td>
      <td>b6</td>
      <td>c6</td>
      <td>d6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a7</td>
      <td>b7</td>
      <td>c7</td>
      <td>d7</td>
    </tr>
    <tr>
      <th>0</th>
      <td>a8</td>
      <td>b8</td>
      <td>c8</td>
      <td>d8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a9</td>
      <td>b9</td>
      <td>c9</td>
      <td>d9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a10</td>
      <td>b10</td>
      <td>c10</td>
      <td>d10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a11</td>
      <td>b11</td>
      <td>c11</td>
      <td>d11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Suppose we want to append a new row to <code class="docutils literal notranslate"><span class="pre">df1</span></code>. Lets create a new row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span><span class="s1">&#39;n2&#39;</span><span class="p">,</span><span class="s1">&#39;n3&#39;</span><span class="p">,</span><span class="s1">&#39;n4&#39;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">new_row</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>b0</td>
      <td>c0</td>
      <td>d0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>b1</td>
      <td>c1</td>
      <td>d1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>b2</td>
      <td>c2</td>
      <td>d2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>b3</td>
      <td>c3</td>
      <td>d3</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>n1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>n2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>n3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>n4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>That’s a lot of missing values. The issue is that the we don’t have column names in the <code class="docutils literal notranslate"><span class="pre">new_row</span></code>, and the indices are the same, so pandas tries to append it my making a new column. The solution is to make it a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span><span class="s1">&#39;n2&#39;</span><span class="p">,</span><span class="s1">&#39;n3&#39;</span><span class="p">,</span><span class="s1">&#39;n4&#39;</span><span class="p">]],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    A   B   C   D
0  n1  n2  n3  n4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">new_row</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>b0</td>
      <td>c0</td>
      <td>d0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>b1</td>
      <td>c1</td>
      <td>d1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>b2</td>
      <td>c2</td>
      <td>d2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>b3</td>
      <td>c3</td>
      <td>d3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>n1</td>
      <td>n2</td>
      <td>n3</td>
      <td>n4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>or</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>b0</td>
      <td>c0</td>
      <td>d0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>b1</td>
      <td>c1</td>
      <td>d1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>b2</td>
      <td>c2</td>
      <td>d2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>b3</td>
      <td>c3</td>
      <td>d3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>n1</td>
      <td>n2</td>
      <td>n3</td>
      <td>n4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="adding-columns">
<h4>Adding columns<a class="headerlink" href="#adding-columns" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">df3</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>b0</td>
      <td>c0</td>
      <td>d0</td>
      <td>a4</td>
      <td>b4</td>
      <td>c4</td>
      <td>d4</td>
      <td>a8</td>
      <td>b8</td>
      <td>c8</td>
      <td>d8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>b1</td>
      <td>c1</td>
      <td>d1</td>
      <td>a5</td>
      <td>b5</td>
      <td>c5</td>
      <td>d5</td>
      <td>a9</td>
      <td>b9</td>
      <td>c9</td>
      <td>d9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>b2</td>
      <td>c2</td>
      <td>d2</td>
      <td>a6</td>
      <td>b6</td>
      <td>c6</td>
      <td>d6</td>
      <td>a10</td>
      <td>b10</td>
      <td>c10</td>
      <td>d10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>b3</td>
      <td>c3</td>
      <td>d3</td>
      <td>a7</td>
      <td>b7</td>
      <td>c7</td>
      <td>d7</td>
      <td>a11</td>
      <td>b11</td>
      <td>c11</td>
      <td>d11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The option <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> ensures that concatenation happens by columns. The default value <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">=</span> <span class="pre">0</span></code> concatenates by rows.</p>
<p>Let’s play a little game. Let’s change the column names of <code class="docutils literal notranslate"><span class="pre">df2</span></code> and <code class="docutils literal notranslate"><span class="pre">df3</span></code> so they are not the same as <code class="docutils literal notranslate"><span class="pre">df1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="n">df3</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">df3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
      <th>G</th>
      <th>H</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>b0</td>
      <td>c0</td>
      <td>d0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>b1</td>
      <td>c1</td>
      <td>d1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>b2</td>
      <td>c2</td>
      <td>d2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>b3</td>
      <td>c3</td>
      <td>d3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>a4</td>
      <td>b4</td>
      <td>c4</td>
      <td>d4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>a5</td>
      <td>b5</td>
      <td>c5</td>
      <td>d5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>a6</td>
      <td>b6</td>
      <td>c6</td>
      <td>d6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>a7</td>
      <td>b7</td>
      <td>c7</td>
      <td>d7</td>
    </tr>
    <tr>
      <th>0</th>
      <td>a8</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b8</td>
      <td>NaN</td>
      <td>c8</td>
      <td>NaN</td>
      <td>d8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a9</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b9</td>
      <td>NaN</td>
      <td>c9</td>
      <td>NaN</td>
      <td>d9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a10</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b10</td>
      <td>NaN</td>
      <td>c10</td>
      <td>NaN</td>
      <td>d10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a11</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b11</td>
      <td>NaN</td>
      <td>c11</td>
      <td>NaN</td>
      <td>d11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now pandas ensures that all column names are represented in the new data frame, but with missing values where the row indices and column indices are mismatched. Some of this can be avoided by only joining on common columns. This is done using the <code class="docutils literal notranslate"><span class="pre">join</span></code> option ir <code class="docutils literal notranslate"><span class="pre">concat</span></code>. The default value is ‘outer`, which is what you see. above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df3</span><span class="p">],</span> <span class="n">join</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a0</td>
      <td>d0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a1</td>
      <td>d1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a2</td>
      <td>d2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a3</td>
      <td>d3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>a8</td>
      <td>b8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a9</td>
      <td>b9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a10</td>
      <td>b10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a11</td>
      <td>b11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can do the same thing when joining by rows, using <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">=</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">join=&quot;inner&quot;</span></code> to only join on rows with matching indices. Reminder that the indices are just labels and happen to be the row numbers by default.</p>
</div>
</div>
<div class="section" id="merging-data-sets">
<h3>Merging data sets<a class="headerlink" href="#merging-data-sets" title="Permalink to this headline">¶</a></h3>
<p>For this section we’ll use a set of data from a survey, also used by Daniel Chen in “Pandas for Everyone”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">person</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_person.csv&#39;</span><span class="p">)</span>
<span class="n">site</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_site.csv&#39;</span><span class="p">)</span>
<span class="n">survey</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_survey.csv&#39;</span><span class="p">)</span>
<span class="n">visited</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_visited.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">128142754.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">person</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_person.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">site</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_site.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">survey</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_survey.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">visited</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/survey_visited.csv&#39;</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">706</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/survey_person.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">4147899475.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;person&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">566976400.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;site&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">survey</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3486118972.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">survey</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;survey&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">visited</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">4161972307.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">visited</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;visited&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>There are basically four kinds of joins:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>pandas</p></th>
<th class="head"><p>R</p></th>
<th class="head"><p>SQL</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>left</p></td>
<td><p>left_join</p></td>
<td><p>left outer</p></td>
<td><p>keep all rows on left</p></td>
</tr>
<tr class="row-odd"><td><p>right</p></td>
<td><p>right_join</p></td>
<td><p>right outer</p></td>
<td><p>keep all rows on right</p></td>
</tr>
<tr class="row-even"><td><p>outer</p></td>
<td><p>outer_join</p></td>
<td><p>full outer</p></td>
<td><p>keep all rows from both</p></td>
</tr>
<tr class="row-odd"><td><p>inner</p></td>
<td><p>inner_join</p></td>
<td><p>inner</p></td>
<td><p>keep only rows with common keys</p></td>
</tr>
</tbody>
</table>
<p><img alt="" src="_images/joins.png" /></p>
<p>The terms <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> refer to which data set you call first and second respectively.</p>
<p>We start with an left join</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s2v_merge</span> <span class="o">=</span> <span class="n">survey</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">visited</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;taken&#39;</span><span class="p">,</span><span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">73176749.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">s2v_merge</span> <span class="o">=</span> <span class="n">survey</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">visited</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;taken&#39;</span><span class="p">,</span><span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;survey&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">s2v_merge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3955402629.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">s2v_merge</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;s2v_merge&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Here, the left dataset is <code class="docutils literal notranslate"><span class="pre">survey</span></code> and the right one is <code class="docutils literal notranslate"><span class="pre">visited</span></code>. Since we’re doing a left join, we keed all the rows from <code class="docutils literal notranslate"><span class="pre">survey</span></code> and add columns from <code class="docutils literal notranslate"><span class="pre">visited</span></code>, matching on the common key, called “taken” in one dataset and “ident” in the other. Note that the rows of <code class="docutils literal notranslate"><span class="pre">visited</span></code> are repeated as needed to line up with all the rows with common “taken” values.</p>
<p>We can now add location information, where the common key is the site code</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s2v2loc_merge</span> <span class="o">=</span> <span class="n">s2v_merge</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s2v2loc_merge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2898790710.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">s2v2loc_merge</span> <span class="o">=</span> <span class="n">s2v_merge</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">s2v2loc_merge</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;s2v_merge&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Lastly, we add the person information to this dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">s2v2loc_merge</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3554302949.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">merged</span> <span class="o">=</span> <span class="n">s2v2loc_merge</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="ne">NameError</span>: name &#39;s2v2loc_merge&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>You can merge based on multiple columns as long as they match up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">survey</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;person&#39;</span><span class="p">)</span>
<span class="n">vs</span> <span class="o">=</span> <span class="n">visited</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">survey</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;taken&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3344022915.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">survey</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;person&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">vs</span> <span class="o">=</span> <span class="n">visited</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">survey</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;ident&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;taken&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;person&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3624111599.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;vs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps_vs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> 
                <span class="n">left_on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ident&#39;</span><span class="p">,</span><span class="s1">&#39;taken&#39;</span><span class="p">,</span> <span class="s1">&#39;quant&#39;</span><span class="p">,</span><span class="s1">&#39;reading&#39;</span><span class="p">],</span>
                <span class="n">right_on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span><span class="s1">&#39;ident&#39;</span><span class="p">,</span><span class="s1">&#39;quant&#39;</span><span class="p">,</span><span class="s1">&#39;reading&#39;</span><span class="p">])</span> <span class="c1"># The keys need to correspond</span>
<span class="n">ps_vs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">98111190.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ps_vs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">2</span>                 <span class="n">left_on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ident&#39;</span><span class="p">,</span><span class="s1">&#39;taken&#39;</span><span class="p">,</span> <span class="s1">&#39;quant&#39;</span><span class="p">,</span><span class="s1">&#39;reading&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                 <span class="n">right_on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span><span class="s1">&#39;ident&#39;</span><span class="p">,</span><span class="s1">&#39;quant&#39;</span><span class="p">,</span><span class="s1">&#39;reading&#39;</span><span class="p">])</span> <span class="c1"># The keys need to correspond</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">ps_vs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;ps&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Note that since there are common column names, the merge appends <code class="docutils literal notranslate"><span class="pre">_x</span></code> and <code class="docutils literal notranslate"><span class="pre">_y</span></code> to denote which column came from the left and right, respectively.</p>
</div>
<div class="section" id="tidy-data-principles-and-reshaping-datasets">
<h3>Tidy data principles and reshaping datasets<a class="headerlink" href="#tidy-data-principles-and-reshaping-datasets" title="Permalink to this headline">¶</a></h3>
<p>The tidy data principle is a principle espoused by Dr. Hadley Wickham, one of the foremost R developers. <a class="reference external" href="http://vita.had.co.nz/papers/tidy-data.pdf">Tidy data</a> is a structure for datasets to make them more easily analyzed on computers. The basic principles are</p>
<ul class="simple">
<li><p>Each row is an observation</p></li>
<li><p>Each column is a variable</p></li>
<li><p>Each type of observational unit forms a table</p></li>
</ul>
<blockquote>
<div><p>Tidy data is tidy in one way. Untidy data can be untidy in many ways</p>
</div></blockquote>
<p>Let’s look at some examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/table*.csv&#39;</span><span class="p">))</span> <span class="c1"># find files matching pattern. I know there are 6 of them</span>
<span class="n">table1</span><span class="p">,</span> <span class="n">table2</span><span class="p">,</span> <span class="n">table3</span><span class="p">,</span> <span class="n">table4a</span><span class="p">,</span> <span class="n">table4b</span><span class="p">,</span> <span class="n">table5</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">]</span> <span class="c1"># Use a list comprehension</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1144216718.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/table*.csv&#39;</span><span class="p">))</span> <span class="c1"># find files matching pattern. I know there are 6 of them</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">table1</span><span class="p">,</span> <span class="n">table2</span><span class="p">,</span> <span class="n">table3</span><span class="p">,</span> <span class="n">table4a</span><span class="p">,</span> <span class="n">table4b</span><span class="p">,</span> <span class="n">table5</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">]</span> <span class="c1"># Use a list comprehension</span>

<span class="ne">ValueError</span>: not enough values to unpack (expected 6, got 0)
</pre></div>
</div>
</div>
</div>
<p>This code imports data from 6 files matching a pattern. Python allows multiple assignments on the left of the <code class="docutils literal notranslate"><span class="pre">=</span></code>, and as each dataset is imported, it gets assigned in order to the variables on the left. In the second line I sort the file names so that they match the order in which I’m storing them in the 3rd line. The function <code class="docutils literal notranslate"><span class="pre">glob</span></code> does pattern-matching of file names.</p>
<p>The following tables refer to the number of TB cases and population in Afghanistan, Brazil and China in 1999 and 2000</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">549743026.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;table1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2780310470.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;table2&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1504731820.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">table3</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;table3&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table4a</span><span class="p">)</span> <span class="c1"># cases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1828465147.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">table4a</span><span class="p">)</span> <span class="c1"># cases</span>

<span class="ne">NameError</span>: name &#39;table4a&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table4b</span><span class="p">)</span> <span class="c1"># population</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3255344754.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">table4b</span><span class="p">)</span> <span class="c1"># population</span>

<span class="ne">NameError</span>: name &#39;table4b&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2572631766.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">table5</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;table5&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise:</strong> Describe why and why not each of these datasets are tidy.</p>
</div>
<div class="section" id="melting-unpivoting-data">
<h3>Melting (unpivoting) data<a class="headerlink" href="#melting-unpivoting-data" title="Permalink to this headline">¶</a></h3>
<p>Melting is the operation of collapsing multiple columns into 2 columns, where one column is formed by the old column names, and the other by the corresponding values. Some columns may be kept fixed and their data are repeated to maintain the interrelationships between the variables.</p>
<p>We’ll start with loading some data on income and religion in the US from the Pew Research Center.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pew</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/pew.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pew</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">4095449745.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pew</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/pew.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">pew</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">706</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/pew.csv&#39;
</pre></div>
</div>
</div>
</div>
<p>This dataset is considered in “wide” format. There are several issues with it, including the fact that column headers have data. Those column headers are income groups, that should be a column by tidy principles. Our job is to turn this dataset into “long” format with a column for income group.</p>
<p>We will use the function <code class="docutils literal notranslate"><span class="pre">melt</span></code> to achieve this. This takes a few parameters:</p>
<ul class="simple">
<li><p><strong>id_vars</strong> is a list of variables that will remain as is</p></li>
<li><p><strong>value_vars</strong> is a list of column nmaes that we will melt (or unpivot). By default, it will melt all columns not mentioned in id_vars</p></li>
<li><p><strong>var_name</strong> is a string giving the name of the new column created by the headers (default: <code class="docutils literal notranslate"><span class="pre">variable</span></code>)</p></li>
<li><p><strong>value_name</strong> is a string giving the name of the new column created by the values (default: <code class="docutils literal notranslate"><span class="pre">value</span></code>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pew_long</span> <span class="o">=</span> <span class="n">pew</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;religion&#39;</span><span class="p">],</span> <span class="n">var_name</span> <span class="o">=</span> <span class="s1">&#39;income_group&#39;</span><span class="p">,</span> <span class="n">value_name</span> <span class="o">=</span> <span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pew_long</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">294988172.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pew_long</span> <span class="o">=</span> <span class="n">pew</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;religion&#39;</span><span class="p">],</span> <span class="n">var_name</span> <span class="o">=</span> <span class="s1">&#39;income_group&#39;</span><span class="p">,</span> <span class="n">value_name</span> <span class="o">=</span> <span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">pew_long</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="ne">NameError</span>: name &#39;pew&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="separating-columns-containing-multiple-variables">
<h3>Separating columns containing multiple variables<a class="headerlink" href="#separating-columns-containing-multiple-variables" title="Permalink to this headline">¶</a></h3>
<p>We will use an Ebola dataset to illustrate this principle</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ebola</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/country_timeseries.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ebola</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2032518627.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ebola</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/country_timeseries.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">ebola</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">706</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/country_timeseries.csv&#39;
</pre></div>
</div>
</div>
</div>
<p>Note that for each country we have two columns – one for cases (number infected) and one for deaths. Ideally we want one column for country, one for cases and one for deaths.</p>
<p>The first step will be to melt this data sets so that the column headers in question from a column and the corresponding data forms a second column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ebola_long</span> <span class="o">=</span> <span class="n">ebola</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ebola_long</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1769107899.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ebola_long</span> <span class="o">=</span> <span class="n">ebola</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">ebola_long</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="ne">NameError</span>: name &#39;ebola&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We now need to split the data in the <code class="docutils literal notranslate"><span class="pre">variable</span></code> column to make two columns. One will contain the country name and the other either Cases or Deaths. We will use some string manipulation functions that we will see later to achieve this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_split</span> <span class="o">=</span> <span class="n">ebola_long</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># split on the `_` character</span>
<span class="nb">print</span><span class="p">(</span><span class="n">variable_split</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1705468411.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">variable_split</span> <span class="o">=</span> <span class="n">ebola_long</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># split on the `_` character</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">variable_split</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;ebola_long&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">expand=True</span></code> option forces the creation of an <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> rather than a list</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">variable_split</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2991697549.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">type</span><span class="p">(</span><span class="n">variable_split</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;variable_split&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can now concatenate this to the original data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_split</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>

<span class="n">ebola_parsed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ebola_long</span><span class="p">,</span> <span class="n">variable_split</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ebola_parsed</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Remove the column named &quot;variable&quot; and replace the old data with the new one in the same location</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ebola_parsed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1928590856.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">variable_split</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ebola_parsed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ebola_long</span><span class="p">,</span> <span class="n">variable_split</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">ebola_parsed</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Remove the column named &quot;variable&quot; and replace the old data with the new one in the same location</span>

<span class="ne">NameError</span>: name &#39;variable_split&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pivot-spread-datasets">
<h3>Pivot/spread datasets<a class="headerlink" href="#pivot-spread-datasets" title="Permalink to this headline">¶</a></h3>
<p>If we wanted to, we could also make two columns based on cases and deaths, so for each country and date you could easily read off the cases and deaths. This is achieved using the <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> function.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> syntax, <code class="docutils literal notranslate"><span class="pre">index</span></code> refers to the columns we don’t want to change, <code class="docutils literal notranslate"><span class="pre">columns</span></code> refers to the column whose values will form the column names of the new columns, and <code class="docutils literal notranslate"><span class="pre">values</span></code> is the name of the column that will form the values in the pivoted dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ebola_parsed</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">1233948716.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ebola_parsed</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;ebola_parsed&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>This creates something called <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> in the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. This is useful in some advanced cases, but here, we just want a normal <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> back. We can achieve that by using the <code class="docutils literal notranslate"><span class="pre">reset_index</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ebola_parsed</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">796435762.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ebola_parsed</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;ebola_parsed&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Pivoting is a 2-column to many-column operation, with the number of columns formed depending on the number of unique values present in the column of the original data that is entered into the <code class="docutils literal notranslate"><span class="pre">columns</span></code> argument of <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code></p>
<p><strong>Exercise:</strong> Load the file <code class="docutils literal notranslate"><span class="pre">weather.csv</span></code> into Python and work on making it a tidy dataset. It requires melting and pivoting. The dataset comprises of the maximun and minimum temperatures recorded each day in 2010. There are lots of missing value. Ultimately we want columns for days of the month, maximum temperature and minimum tempearture along with the location ID, the year and the month.</p>
</div>
</div>
<div class="section" id="data-aggregation-and-split-apply-combine">
<h2>Data aggregation and split-apply-combine<a class="headerlink" href="#data-aggregation-and-split-apply-combine" title="Permalink to this headline">¶</a></h2>
<p>We’ll use the Gapminder dataset for this section</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/gapminder.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># data is tab-separated, so we use `\t` to specify that</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">666932268.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/gapminder.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># data is tab-separated, so we use `\t` to specify that</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">706</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/gapminder.tsv&#39;
</pre></div>
</div>
</div>
</div>
<p>The paradigm we will be exploring is often called <em>split-apply-combine</em> or MapReduce or grouped aggregation. The basic idea is that you split a data set up by some feature, apply a recipe to each piece, compute the result, and then put the results back together into a dataset. This can be described in teh following schematic.</p>
<p><img alt="" src="_images/split-apply-combine.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> is set up for this. It features the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> function that allows the “split” part of the operation. We can then apply a function to each part and put it back together. Let’s see how.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
      <th>five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.237807</td>
      <td>-0.719080</td>
      <td>0.340146</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>c</th>
      <td>0.542306</td>
      <td>-0.119726</td>
      <td>-1.423387</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>e</th>
      <td>2.127543</td>
      <td>0.681932</td>
      <td>1.149117</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>f</th>
      <td>-0.453755</td>
      <td>1.662654</td>
      <td>-1.918944</td>
      <td>20</td>
      <td>False</td>
    </tr>
    <tr>
      <th>g</th>
      <td>0.873007</td>
      <td>-1.435325</td>
      <td>1.347852</td>
      <td>20</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sa">f</span><span class="s2">&quot;This dataset has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2"> countries in it&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/indexes/base.py</span> in <span class="ni">get_loc</span><span class="nt">(self, key, method, tolerance)</span>
<span class="g g-Whitespace">   </span><span class="mi">3360</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3361</span>                 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">casted_key</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3362</span>             <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/_libs/index.pyx</span> in <span class="ni">pandas._libs.index.IndexEngine.get_loc</span><span class="nt">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/_libs/index.pyx</span> in <span class="ni">pandas._libs.index.IndexEngine.get_loc</span><span class="nt">()</span>

<span class="nn">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ni">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="nt">()</span>

<span class="nn">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ni">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="nt">()</span>

<span class="ne">KeyError</span>: &#39;country&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">725679992.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="sa">f</span><span class="s2">&quot;This dataset has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2"> countries in it&quot;</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">   </span><span class="mi">3453</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3454</span>                 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem_multilevel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3455</span>             <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3456</span>             <span class="k">if</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">indexer</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">3457</span>                 <span class="n">indexer</span> <span class="o">=</span> <span class="p">[</span><span class="n">indexer</span><span class="p">]</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/indexes/base.py</span> in <span class="ni">get_loc</span><span class="nt">(self, key, method, tolerance)</span>
<span class="g g-Whitespace">   </span><span class="mi">3361</span>                 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">casted_key</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3362</span>             <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3363</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
<span class="g g-Whitespace">   </span><span class="mi">3364</span> 
<span class="g g-Whitespace">   </span><span class="mi">3365</span>         <span class="k">if</span> <span class="n">is_scalar</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isna</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasnans</span><span class="p">:</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<p>One of the variables in this dataset is life expectancy at birth, <code class="docutils literal notranslate"><span class="pre">lifeExp</span></code>. Suppose we want to find the average life expectancy of each country over the period of study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)[</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2769936288.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)[</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<p>So what’s going on here? First, we use the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> function, telling <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to split the dataset up by values of the column <code class="docutils literal notranslate"><span class="pre">country</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2961036233.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> won’t show you the actual data, but will tell you that it is a grouped dataframe object. This means that each element of this object is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with data from one country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ngroups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3617846814.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ngroups</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3026866286.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2097454823.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">))</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_lifeexp_country</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">avg_lifeexp_country</span><span class="p">[</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">4174092961.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">avg_lifeexp_country</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">avg_lifeexp_country</span><span class="p">[</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">]</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3762612184.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;United Kingdom&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
<p>Let’s look at if life expectancy has gone up over time, by continent</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3067082591.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;continent&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_lifeexp_continent_yr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">avg_lifeexp_continent_yr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2548186996.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">avg_lifeexp_continent_yr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">avg_lifeexp_continent_yr</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;continent&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">avg_lifeexp_continent_yr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">962510996.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">type</span><span class="p">(</span><span class="n">avg_lifeexp_continent_yr</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;avg_lifeexp_continent_yr&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The aggregation function, in this case <code class="docutils literal notranslate"><span class="pre">mean</span></code>, does both the “apply” and “combine” parts of the process.</p>
<p>We can do quick aggregations with <code class="docutils literal notranslate"><span class="pre">pandas</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">839679824.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;continent&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Tenth observation in each group</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3446819986.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Tenth observation in each group</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;continent&#39;
</pre></div>
</div>
</div>
</div>
<p>You can also use functions from other modules, or your own functions in this aggregation work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2611877666.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;continent&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_mean</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="n">value</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2911735084.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> 
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_mean</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;continent&#39;
</pre></div>
</div>
</div>
</div>
<p>You can do many functions at once</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">4252245699.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;year&#39;
</pre></div>
</div>
</div>
</div>
<p>You can also aggregate on different columns at the same time by passing a <code class="docutils literal notranslate"><span class="pre">dict</span></code> to the <code class="docutils literal notranslate"><span class="pre">agg</span></code> function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span><span class="s1">&#39;gdpPercap&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">4230181690.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span><span class="s1">&#39;gdpPercap&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;year&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="transformation">
<h3>Transformation<a class="headerlink" href="#transformation" title="Permalink to this headline">¶</a></h3>
<p>You can do grouped transformations using this same method. We will compute the z-score for each year, i.e. we will substract the average life expectancy and divide by the standard deviation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_zscore</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span><span class="p">((</span><span class="n">values</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">my_zscore</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2203418909.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">my_zscore</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;year&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;lifeExp_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">my_zscore</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3126734174.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lifeExp_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">my_zscore</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;year&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp_z</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">2647309254.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp_z</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;year&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filter">
<h3>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h3>
<p>We can split the dataset by values of one variable, and filter out those splits that fail some criterion. The following code only keeps countries with a population of at least 10 million at some point during the study period</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10000000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">k4</span><span class="o">/</span><span class="n">xvcmx4yx76xdbl41zy3hq8rc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26956</span><span class="o">/</span><span class="mf">3295239075.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10000000</span><span class="p">)</span>

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/frame.py</span> in <span class="ni">groupby</span><span class="nt">(self, by, axis, level, as_index, sort, group_keys, squeeze, observed, dropna)</span>
<span class="g g-Whitespace">   </span><span class="mi">7634</span>             <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">   </span><span class="mi">7635</span>             <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">7636</span>             <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">7637</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7638</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, keys, axis, level, grouper, exclusions, selection, as_index, sort, group_keys, squeeze, observed, mutated, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>                 <span class="n">mutated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutated</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">896</span>                 <span class="n">dropna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> 

<span class="nn">~/Python/venvs/biof440_env/lib/python3.7/site-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">get_grouper</span><span class="nt">(obj, key, axis, level, sort, observed, mutated, validate, dropna)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>                 <span class="n">in_axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">gpr</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gpr</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">860</span>                 <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">gpr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gpr</span><span class="p">,</span> <span class="n">Grouper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gpr</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="c1"># Add key to exclusions</span>

<span class="ne">KeyError</span>: &#39;country&#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="01_python_tools_ds.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Python tools for data science</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="03_python_vis.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Data visualization using Python</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Abhijit Dasgupta<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>